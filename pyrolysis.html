<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç”Ÿç‰©è´¨çƒ­è§£ç‚­åŒ–å·¥è‰ºå…¨æµç¨‹è™šæ‹Ÿä»¿çœŸ (V8.0 Science Edition)</title>
    <style>
        /* --- å·¥ä¸šæ·±è‰²UIé£æ ¼ (V8 ç²¾è‡´ç‰ˆ) --- */
        :root {
            --bg: #0a0b0d; --panel: #111316; --border: #202328;
            --accent: #00f0ff; --accent-dim: rgba(0, 240, 255, 0.2);
            /* è°ƒæ•´äº†äº§ç‰©é¢œè‰²ï¼Œä½¿å…¶æ›´å…·å·¥ä¸šæ„Ÿ */
            --oil: #ff3366; /* æ›´é²œè‰³çš„ç«çº¢ */
            --gas: #ffd700; /* é‡‘é»„è‰² */
            --char: #2a2a2a; --char-hot: #ff4500; /* æ©™çº¢é«˜æ¸©è‰² */
            --text: #e1e1e1; --text-dim: #8a8f99;
            --success: #00c853; --warning: #ffd600; --danger: #ff1744;
        }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', 'Roboto', sans-serif; overflow: hidden; touch-action: none; -webkit-font-smoothing: antialiased; }

        /* å¸ƒå±€æ¡†æ¶ */
        .app-container { display: flex; height: 100vh; }
        /* è§†å£èƒŒæ™¯ï¼šæ›´æ·±é‚ƒã€æ›´èšç„¦ */
        .viewport { flex: 3; position: relative; background: radial-gradient(circle at 50% 50%, #1a1c20 0%, #0a0b0d 80%); overflow: hidden; }
        .controls { flex: 1; min-width: 340px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; box-shadow: -10px 0 40px rgba(0,0,0,0.6); z-index: 20; overflow-y: auto; }

        /* HUD ä»ªè¡¨æ¿å¤´éƒ¨ */
        .hud-header { position: absolute; top: 0; left: 0; right: 0; padding: 25px; display: flex; justify-content: space-between; pointer-events: none; user-select: none; background: linear-gradient(to bottom, rgba(10,11,13,0.9), transparent); }
        .title h1 { margin: 0; font-size: 26px; color: var(--accent); letter-spacing: 4px; font-weight: 300; text-transform: uppercase; text-shadow: 0 0 10px var(--accent-dim); }
        .title small { color: var(--text-dim); font-size: 12px; letter-spacing: 1px; display: block; margin-top: 5px; }
        .status-badge { background: rgba(0, 200, 83, 0.1); color: var(--success); padding: 8px 16px; border-radius: 4px; font-weight: 600; font-family: monospace; border: 1px solid var(--success); display: flex; align-items: center; backdrop-filter: blur(5px); }
        .status-badge.running { background: rgba(0, 240, 255, 0.1); color: var(--accent); border-color: var(--accent); box-shadow: 0 0 20px var(--accent-dim); }

        /* --- SVG 3D è®¾å¤‡æ ·å¼ (V8 ç¾å­¦ä¼˜åŒ–) --- */
        svg { width: 100%; height: 100%; }
        
        /* äº¤äº’é«˜äº®ä¼˜åŒ–ï¼šæ›´å…‹åˆ¶ã€æ›´èšç„¦ */
        .device-group { cursor: pointer; }
        .device-group:hover .shell { stroke: var(--accent); filter: drop-shadow(0 0 8px var(--accent-dim)); }
        
        /* è®¾å¤‡å¤–å£³ï¼šæ·±è‰²é‡‘å±è´¨æ„Ÿ */
        .shell { fill: url(#metalGrad); stroke: #4a4f55; stroke-width: 1.2; transition: all 0.4s ease; }
        
        /* å†…éƒ¨ç»“æ„ */
        .inner-mech, .inner-material { opacity: 0; transition: opacity 0.4s ease; pointer-events: none; }
        .inner-mech path, .inner-mech line, .inner-mech rect { stroke: var(--accent); stroke-width: 1.2; fill: none; filter: drop-shadow(0 0 4px var(--accent-dim)); }

        /* ç®¡é“ç³»ç»Ÿ (åŸºåº•) */
        .pipe-base { fill: none; stroke: #1f2226; stroke-width: 10; stroke-linecap: round; stroke-linejoin: round; filter: drop-shadow(1px 2px 4px rgba(0,0,0,0.5)); }
        .pipe-connect { stroke-width: 8; }

        /* --- å¯è§†åŒ–æµä½“ (V8 ç²¾è‡´é‡æ„ - æ ¸å¿ƒç¾åŒ–ç‚¹) --- */
        /* åŸºç¡€æµä½“ï¼šé»˜è®¤ä¸å¯è§ï¼Œçº¿æ¡æ›´ç»†ï¼Œä½äºç®¡é“ä¸­å¿ƒ */
        .flow-stream { fill: none; stroke-width: 0; stroke-dasharray: 10, 20; stroke-linecap: round; opacity: 0.9; transition: stroke-width 0.5s ease-out; pointer-events: none; }
        .flow-stream.flowing { animation: flowAnim linear infinite; }
        @keyframes flowAnim { from { stroke-dashoffset: 30; } to { stroke-dashoffset: 0; } }

        /* å„ç›¸æµä½“ç‰¹å¾ - æ”¾å¼ƒç²—ç³™çš„å¤§å…‰æ™•ï¼Œä½¿ç”¨ç´§è‡´çš„æ ¸å¿ƒå‘å…‰ */
        .flow-solid { stroke: #8899a6; filter: drop-shadow(0 0 2px #8899a6); }
        /* æ²¹å’Œæ°”çš„å‘å…‰æ•ˆæœç§»è‡³ SVG filter ä¸­å®šä¹‰ï¼Œä»¥è·å¾—æ›´å¥½çš„æ§åˆ¶ */
        .flow-oil { stroke: var(--oil); filter: url(#glow-oil); }
        .flow-gas { stroke: var(--gas); filter: url(#glow-gas); stroke-dasharray: 5, 15; }
        .flow-char-hot { stroke: var(--char-hot); filter: url(#glow-hot); }

        /* åŠ¨æ€éƒ¨ä»¶åŠ¨ç”»ç±» */
        .rotating { transform-box: fill-box; transform-origin: center; }

        /* æ ‡ç­¾ */
        .label-tag { font-size: 11px; fill: var(--accent); font-family: 'Segoe UI', monospace; font-weight: 600; pointer-events: none; text-anchor: middle; letter-spacing: 0.5px; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }

        /* --- å³ä¾§æ§åˆ¶å° --- */
        .panel-section { padding: 20px; border-bottom: 1px solid var(--border); }
        .section-title { color: var(--text); font-size: 14px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; letter-spacing: 1px; text-transform: uppercase; }
        .section-title i { margin-right: 10px; color: var(--accent); }
        
        /* å‚æ•°æ»‘å—æ§ä»¶ç»„ */
        .control-group { margin-bottom: 20px; }
        .control-header { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 8px; color: var(--text-dim); }
        .control-val { font-family: monospace; color: var(--accent); font-weight: 700; }
        .control-desc { font-size: 11px; color: #666; margin-top: 5px; display: flex; justify-content: space-between; }

        /* è‡ªå®šä¹‰æ»‘å— - æ›´ç²¾è‡´ */
        input[type=range] { -webkit-appearance: none; width: 100%; height: 3px; background: #2a2e33; border-radius: 2px; outline: none; transition: background 0.3s; }
        input[type=range]:hover { background: #3a3e44; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--bg); border: 2px solid var(--accent); border-radius: 50%; cursor: pointer; box-shadow: 0 0 8px var(--accent-dim); transition: all 0.2s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); background: var(--accent); }

        /* ä¸»æ§æŒ‰é’® */
        .btn-main { width: 100%; padding: 14px; border: 1px solid var(--accent); background: rgba(0, 240, 255, 0.05); color: var(--accent); font-size: 15px; font-weight: 700; border-radius: 4px; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px; backdrop-filter: blur(5px); }
        .btn-main:hover { background: var(--accent); color: var(--bg); box-shadow: 0 0 25px var(--accent-dim); }
        .btn-main.stop { border-color: var(--danger); background: rgba(255, 23, 68, 0.1); color: var(--danger); }
        .btn-main.stop:hover { background: var(--danger); color: white; box-shadow: 0 0 25px rgba(255, 23, 68, 0.3); }

        /* ä»ªè¡¨ç›˜å¼äº§ç‰©æ˜¾ç¤º */
        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .dash-card { background: #16181d; padding: 15px 10px; border-radius: 6px; text-align: center; border: 1px solid var(--border); position: relative; overflow: hidden; box-shadow: inset 0 0 20px rgba(0,0,0,0.2); }
        /* ä½¿ç”¨æ›´äº®çš„åº•éƒ¨å…‰æ¡ */
        .dash-card::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; box-shadow: 0 -2px 10px currentColor; }
        .dash-card.char { color: #aaa; } .dash-card.char::after { background: #aaa; }
        .dash-card.oil { color: var(--oil); } .dash-card.oil::after { background: var(--oil); }
        .dash-card.gas { color: var(--gas); } .dash-card.gas::after { background: var(--gas); }

        .dash-val { font-size: 22px; font-family: monospace; font-weight: 700; margin: 5px 0; }
        .dash-label { font-size: 11px; opacity: 0.7; text-transform: uppercase; }
        .rate-indicator { font-size: 10px; color: var(--accent); margin-top: 5px; opacity: 0; transition: opacity 0.5s; }
        .rate-indicator.active { opacity: 1; }

        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .app-container { flex-direction: column; height: auto; }
            .viewport { height: 55vh; }
            .controls { width: 100%; border-left: none; border-top: 1px solid var(--border); max-height: 45vh; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- å·¦ä¾§ï¼š3Då·¥è‰ºè§†å£ -->
    <div class="viewport">
        <div class="hud-header">
            <div class="title">
                <h1>Pyrolysis Digital Twin</h1>
                <small>V8.0 Science Edition | ç”Ÿç‰©è´¨çƒ­è§£ç‚­åŒ–å·¥è‰ºå…¨æµç¨‹ä»¿çœŸ</small>
            </div>
            <div class="status-badge" id="sys-status">SYSTEM STANDBY</div>
        </div>

        <svg viewBox="0 0 1200 700" preserveAspectRatio="xMidYMid meet" id="main-svg">
            <defs>
                <!-- æè´¨å®šä¹‰ -->
                <linearGradient id="metalGrad" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stop-color="#3e444b" />
                    <stop offset="50%" stop-color="#2e3238" />
                    <stop offset="100%" stop-color="#1c1e22" />
                </linearGradient>
                <radialGradient id="fireGrad" cx="50%" cy="70%" r="60%">
                    <stop offset="0%" stop-color="#fff59d" stop-opacity="1" />
                    <stop offset="40%" stop-color="#ff9800" stop-opacity="0.8" />
                    <stop offset="100%" stop-color="#ff3d00" stop-opacity="0" />
                </radialGradient>
                <linearGradient id="oilLiquidGrad" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="#ff5c8d" />
                    <stop offset="100%" stop-color="#c2185b" />
                </linearGradient>
                <!-- æ»¤é•œï¼šçƒ­æµªæ‰­æ›²æ•ˆæœ -->
                <filter id="heatWave">
                    <feTurbulence type="fractalNoise" baseFrequency="0.01 0.02" numOctaves="1" result="noise" seed="1">
                        <animate attributeName="baseFrequency" values="0.01 0.02;0.01 0.04;0.01 0.02" dur="2s" repeatCount="indefinite"/>
                    </feTurbulence>
                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="5" />
                </filter>
                
                <!-- ã€V8 æ–°å¢ã€‘ç²¾è‡´è¾‰å…‰æ»¤é•œå®šä¹‰ (æ›¿ä»£ç²—ç³™çš„ drop-shadow) -->
                <!-- ç”Ÿç‰©æ²¹è¾‰å…‰ -->
                <filter id="glow-oil" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="2" result="blur" in="SourceGraphic"/>
                    <feColorMatrix in="blur" type="matrix" values="0 0 0 0 1  0 0 0 0 0.2  0 0 0 0 0.4  0 0 0 1 0" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
                <!-- çƒ­è§£æ°”è¾‰å…‰ -->
                <filter id="glow-gas" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="3" result="blur" in="SourceGraphic"/>
                    <feColorMatrix in="blur" type="matrix" values="0 0 0 0 1  0 0 0 0 0.84 0 0 0 0 0    0 0 0 1 0" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
                <!-- é«˜æ¸©ç‚­è¾‰å…‰ -->
                <filter id="glow-hot" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="2.5" result="blur" in="SourceGraphic"/>
                    <feColorMatrix in="blur" type="matrix" values="0 0 0 0 1  0 0 0 0 0.27 0 0 0 0 0    0 0 0 1 0" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>

            <!-- ================= å·¥è‰ºæµç¨‹ç»˜åˆ¶åŒºåŸŸ ================= -->

            <!-- 1. ç ´ç¢ä¸é¢„å¤„ç† -->
            <g id="grp-crush" transform="translate(50, 120)" class="device-group">
                <text x="50" y="-25" class="label-tag">1.ç ´ç¢/é¢„å¤„ç† (Crusher)</text>
                <path d="M10 20 L90 20 L70 80 L30 80 Z" class="shell" />
                <rect x="20" y="80" width="60" height="50" class="shell" />
                <!-- å†…éƒ¨ç»“æ„ (é€è§†å¯è§) -->
                <g class="inner-mech">
                    <circle cx="50" cy="105" r="20" stroke-dasharray="4,4" class="rotating" id="anim-crush-1"/>
                    <path d="M30 105 L70 105 M50 85 L50 125" stroke-width="3" class="rotating" id="anim-crush-2"/>
                </g>
            </g>

            <!-- ç®¡é“ï¼šå›ºä½“è¿›æ–™ -->
            <path d="M50 170 L50 220 L140 220" class="pipe-base" />
            <path d="M50 170 L50 220 L140 220" class="flow-stream flow-solid" id="flow-feed" />

            <!-- 2. å›è½¬å¹²ç‡¥å™¨ -->
            <g id="grp-dry" transform="translate(140, 200)" class="device-group">
                <text x="80" y="-35" class="label-tag">2.å¹²ç‡¥å™¨ (Dryer)</text>
                <g transform="rotate(4)">
                    <rect x="0" y="0" width="160" height="60" rx="8" class="shell" />
                    <g class="inner-mech">
                        <line x1="10" y1="15" x2="150" y2="15" stroke-dasharray="8,4" />
                        <line x1="10" y1="45" x2="150" y2="45" stroke-dasharray="8,4" />
                        <!-- ç‰©æ–™ç¿»æ»šåŠ¨ç”» -->
                        <path d="M30 35 Q50 15 70 35 T110 35" stroke="#7f8c8d" stroke-width="3" fill="none">
                            <animate attributeName="d" values="M30 35 Q50 15 70 35 T110 35; M30 35 Q50 55 70 35 T110 35; M30 35 Q50 15 70 35 T110 35" dur="4s" repeatCount="indefinite"/>
                        </path>
                    </g>
                </g>
                <!-- æ‰˜è½® -->
                <circle cx="40" cy="65" r="8" fill="#222" stroke="#444" />
                <circle cx="120" cy="65" r="8" fill="#222" stroke="#444" />
            </g>

            <!-- ç®¡é“ä¸è¿›æ–™èºæ—‹ç»“æ„ -->
            <path d="M300 220 L340 220" class="pipe-base" />
            <path d="M300 220 L340 220" class="flow-stream flow-solid" id="flow-dry" />
            
            <g id="grp-feed-screw" transform="translate(340, 200)" class="device-group">
                <text x="30" y="-15" class="label-tag">è¿›æ–™èºæ—‹</text>
                <rect x="0" y="10" width="60" height="30" rx="5" class="shell" />
                <g class="inner-mech">
                    <line x1="5" y1="25" x2="55" y2="25" />
                    <path d="M5 25 L55 25" stroke-width="8" stroke-dasharray="4,8" class="rotating" id="anim-feed-screw" />
                </g>
            </g>

            <!-- 3. å›è½¬å¼çƒ­è§£ç‚‰ (æ ¸å¿ƒè®¾å¤‡) -->
            <g id="grp-kiln" transform="translate(420, 250)" class="device-group">
                <text x="150" y="-55" class="label-tag" font-size="14" fill="#fff">3.å›è½¬çƒ­è§£ç‚‰ (Pyrolysis Reactor)</text>
                
                <!-- ç‡ƒçƒ§å®¤/åŠ çƒ­å¥— -->
                <path d="M30 80 L270 80 L250 130 L50 130 Z" fill="#16181d" stroke="#2c3035" />
                <!-- ç«ç„°ä¸çƒ­æµª -->
                <g id="fire-effect" style="opacity:0; transition: opacity 0.8s;">
                    <ellipse cx="150" cy="110" rx="80" ry="25" fill="url(#fireGrad)" filter="url(#heatWave)" style="mix-blend-mode: screen;" />
                </g>

                <!-- æ—‹è½¬ç‚‰ä½“ -->
                <g transform="rotate(3, 150, 40)">
                    <path d="M0 0 L300 0 L300 80 L0 80 Z" class="shell" />
                    <ellipse cx="0" cy="40" rx="12" ry="40" class="shell" fill="#2c3035" />
                    <ellipse cx="300" cy="40" rx="12" ry="40" class="shell" fill="#4a4f55" />
                    
                    <!-- å†…éƒ¨ç»“æ„ (é€è§†å¯è§) -->
                    <g class="inner-mech">
                        <line x1="0" y1="40" x2="300" y2="40" stroke-width="3" />
                        <!-- å¯¼æ–™èºæ—‹æ¿ -->
                        <path d="M20 40 Q60 -10 100 40 T180 40 T260 40" fill="none" stroke-width="2" class="rotating" transform-origin="150 40" id="anim-kiln-screw"/>
                        <!-- ååº”åŒºéš”æ¿ç¤ºæ„ -->
                        <line x1="100" y1="5" x2="100" y2="75" stroke-dasharray="2,2" opacity="0.5"/>
                        <line x1="200" y1="5" x2="200" y2="75" stroke-dasharray="2,2" opacity="0.5"/>
                    </g>
                    <!-- å†…éƒ¨ç‰©æ–™ (é€è§†å¯è§) -->
                    <g class="inner-material" id="kiln-material">
                        <rect x="20" y="60" width="80" height="15" fill="#555" /> <!-- å¹²ç‡¥æ®µ -->
                        <rect x="110" y="60" width="80" height="15" fill="#3d3d3d" /> <!-- çƒ­è§£æ®µ -->
                        <rect x="210" y="60" width="70" height="15" fill="#222" /> <!-- ç‚­åŒ–æ®µ -->
                    </g>
                </g>
            </g>

            <!-- ç®¡é“ï¼šçƒ­è§£æ°”å‡ºå£ -->
            <path d="M550 250 L550 120 L750 120" class="pipe-base" />
            <path d="M550 250 L550 120 L750 120" class="flow-stream flow-gas" id="flow-raw-gas"/>
            
            <!-- æ°”ä½“è½¬å­æµé‡è®¡åŠ¨ç”» -->
            <g transform="translate(630, 100)">
                <rect x="-10" y="-20" width="20" height="40" fill="rgba(255,255,255,0.1)" stroke="#4a4f55" />
                <polygon points="-5,15 5,15 0,5" fill="var(--gas)" id="gas-rotameter">
                    <!-- é€šè¿‡JSæ§åˆ¶Yè½´ä½ç½®æ¥æ¨¡æ‹Ÿæµé‡è¯»æ•° -->
                </polygon>
            </g>

            <!-- 4. å†·å‡ç³»ç»Ÿ -->
            <g id="grp-condense" transform="translate(750, 60)" class="device-group">
                <text x="40" y="-20" class="label-tag">4.å†·å‡å™¨</text>
                <rect x="0" y="0" width="80" height="140" class="shell" />
                <g class="inner-mech">
                    <line x1="25" y1="10" x2="25" y2="130" stroke-width="4" stroke="#00e5ff" />
                    <line x1="55" y1="10" x2="55" y2="130" stroke-width="4" stroke="#00e5ff" />
                </g>
            </g>

            <!-- ç”Ÿç‰©æ²¹é›†æ²¹è§†é•œä¸æ¶²ä½å¯è§†åŒ– -->
            <g transform="translate(760, 200)">
                <text x="30" y="65" class="label-tag" fill="var(--oil)">ç”Ÿç‰©æ²¹æ”¶é›†</text>
                <!-- è§†é•œç»ç’ƒ -->
                <rect x="0" y="0" width="60" height="50" fill="rgba(255, 51, 102, 0.1)" stroke="#4a4f55" stroke-width="2" />
                <!-- åŠ¨æ€æ¶²ä½ -->
                <rect x="2" y="48" width="56" height="0" fill="url(#oilLiquidGrad)" opacity="0.9" id="oil-level-visual">
                    <animate attributeName="height" values="10;12;10" dur="2s" repeatCount="indefinite" id="oil-wave-anim"/>
                    <animate attributeName="y" values="38;36;38" dur="2s" repeatCount="indefinite" id="oil-wave-anim-y"/>
                </rect>
                <!-- æ¶²æ»´æ»´è½åŠ¨ç”» -->
                <circle cx="30" cy="0" r="3" fill="var(--oil)" opacity="0" id="oil-drip">
                    <animate id="oil-drip-anim" attributeName="cy" from="0" to="40" dur="1s" repeatCount="indefinite" begin="indefinite" />
                    <animate id="oil-drip-op-anim" attributeName="opacity" values="1;0" dur="1s" repeatCount="indefinite" begin="indefinite" />
                </circle>
            </g>

            <!-- ç®¡é“ï¼šä¸å‡æ°” -->
            <path d="M830 100 L920 100 L920 40" class="pipe-base pipe-connect" />
            <path d="M830 100 L920 100 L920 40" class="flow-stream flow-gas" id="flow-clean-gas" />
            <text x="920" y="30" class="label-tag" fill="var(--gas)">è‡³ç«ç‚¬/å›ç”¨</text>

            <!-- ç®¡é“ï¼šé«˜æ¸©ç‚­å‡ºæ–™ -->
            <path d="M720 320 L850 320 L850 420" class="pipe-base" />
            <path d="M720 320 L850 320 L850 420" class="flow-stream flow-char-hot" id="flow-hot-char" />

            <!-- 5. æ°´å†·èºæ—‹å‡ºæ–™æœº -->
            <g id="grp-cool" transform="translate(800, 420)" class="device-group">
                <text x="75" y="-25" class="label-tag">5.æ°´å†·èºæ—‹ (Cooling Screw)</text>
                <!-- æ°´å¥— -->
                <rect x="-5" y="-5" width="160" height="40" rx="20" fill="rgba(0, 240, 255, 0.15)" stroke="#00e5ff" stroke-width="1"/>
                <rect x="0" y="0" width="150" height="30" rx="15" class="shell" />
                <!-- å†…éƒ¨èºæ—‹ (é€è§†å¯è§) -->
                <g class="inner-mech">
                    <path d="M10 15 L140 15" stroke-width="6" stroke-dasharray="4,6" class="rotating" id="anim-cool-screw" />
                </g>
            </g>
            
            <!-- è¿æ¥ç®¡é“ï¼šæ°´å†· -> æˆå“ä»“ -->
            <path d="M950 435 L980 435" class="pipe-base pipe-connect" />
            <path d="M950 435 L980 435" class="flow-stream flow-solid" id="flow-cooled-char" />

            <!-- 6. æˆå“ä»“ä¸äº§ç‰©å¯è§†åŒ– -->
            <g id="grp-store" transform="translate(980, 380)" class="device-group">
                <text x="40" y="-20" class="label-tag">6.ç”Ÿç‰©ç‚­æˆå“ä»“</text>
                <path d="M0 0 L80 0 L70 140 L10 140 Z" class="shell" />
                <!-- å¯è§†åŒ–çš„ç”Ÿç‰©ç‚­å †ç§¯ -->
                <defs>
                    <clipPath id="siloClip">
                         <path d="M0 0 L80 0 L70 140 L10 140 Z" />
                    </clipPath>
                </defs>
                <g clip-path="url(#siloClip)">
                    <!-- ç‚­å †å®ä½“ï¼šé«˜åº¦ç”±JSæ§åˆ¶ -->
                    <rect x="0" y="140" width="80" height="0" fill="#222" id="char-pile-visual">
                        <animate attributeName="fill" values="#222;#2a2a2a;#222" dur="5s" repeatCount="indefinite"/>
                    </rect>
                </g>
                <!-- æ£€è§†çª— -->
                <rect x="30" y="50" width="20" height="60" fill="rgba(255,255,255,0.05)" stroke="#4a4f55"/>
            </g>

        </svg>
        
        <!-- X-Ray æ§åˆ¶è¦†ç›–å±‚ -->
        <div style="position: absolute; bottom: 20px; left: 20px; background: rgba(20,22,25,0.9); padding: 10px 15px; border-radius: 30px; border: 1px solid var(--accent); display: flex; align-items: center; backdrop-filter: blur(5px);">
            <i style="color:var(--accent); margin-right:10px;">ğŸ‘ï¸</i>
            <span style="font-size: 12px; margin-right: 10px; color:var(--accent);">é€è§†æ¨¡å¼ (X-RAY)</span>
            <input type="range" min="0" max="100" value="100" style="width: 100px;" oninput="updateXRay(this.value)">
        </div>
    </div>

    <!-- å³ä¾§ï¼šå·¥è‰ºæ§åˆ¶å° -->
    <div class="controls">
        
        <!-- A. ä¸»æ§åŒº -->
        <div class="panel-section" style="background: linear-gradient(to bottom, rgba(0,240,255,0.05), transparent);">
            <div class="section-title"><i>âš¡</i> ä»¿çœŸæ€»æ§ (MAIN CONTROL)</div>
            <button class="btn-main" id="btn-start" onclick="toggleSim()">å¯åŠ¨å·¥è‰ºæµç¨‹ (START)</button>
            <!-- ä»ªè¡¨ç›˜æ˜¾ç¤º -->
            <div class="dashboard-grid">
                <div class="dash-card char">
                    <div class="dash-val" id="db-char">0%</div>
                    <div class="dash-label">ç”Ÿç‰©ç‚­ (Solid)</div>
                    <div class="rate-indicator" id="rate-char">Collecting...</div>
                </div>
                <div class="dash-card oil">
                    <div class="dash-val" id="db-oil">0%</div>
                    <div class="dash-label">ç”Ÿç‰©æ²¹ (Liquid)</div>
                    <div class="rate-indicator" id="rate-oil">Condensing...</div>
                </div>
                <div class="dash-card gas">
                    <div class="dash-val" id="db-gas">0%</div>
                    <div class="dash-label">çƒ­è§£æ°” (Gas)</div>
                    <div class="rate-indicator" id="rate-gas">Vaporizing...</div>
                </div>
            </div>
        </div>

        <!-- B. åŸæ–™ç‰¹æ€§ (Feedstock) -->
        <div class="panel-section">
            <div class="section-title"><i>ğŸ“¦</i> åŸæ–™ç‰¹æ€§ (Feedstock)</div>
            
            <div class="control-group">
                <div class="control-header">
                    <span>1. å«æ°´ç‡ (Moisture)</span>
                    <span id="val-water" class="control-val">15%</span>
                </div>
                <input type="range" min="5" max="50" value="15" oninput="updateParam('water', this.value)">
                <div class="control-desc"><span>å¹²ç‡¥</span><span>æ¹¿æ¶¦</span></div>
            </div>
            
            <div class="control-group">
                <div class="control-header">
                    <span>2. ç‰©æ–™ç²’å¾„ (Particle Size)</span>
                    <span id="val-size" class="control-val">20 mm</span>
                </div>
                <input type="range" min="5" max="50" step="5" value="20" oninput="updateParam('size', this.value)">
                <div class="control-desc"><span>ç»†ç²‰ (ä¼ çƒ­å¿«)</span><span>å¤§å— (ä¼ çƒ­æ…¢)</span></div>
            </div>
        </div>

        <!-- C. ååº”æ¡ä»¶ (Reaction) -->
        <div class="panel-section">
            <div class="section-title"><i>ğŸ”¥</i> ååº”æ ¸å¿ƒå‚æ•° (Reactor)</div>
            
            <div class="control-group">
                <div class="control-header">
                    <span>3. çƒ­è§£ç»ˆæ¸© (Temperature)</span>
                    <span id="val-temp" class="control-val">550â„ƒ</span>
                </div>
                <input type="range" min="300" max="850" step="10" value="550" oninput="updateParam('temp', this.value)">
                <div class="control-desc">
                    <span style="color:#aaa">ä½æ¸©ç‚­åŒ–</span>
                    <span style="color:var(--oil)">ä¸­æ¸©äº§æ²¹</span>
                    <span style="color:var(--gas)">é«˜æ¸©è£‚è§£</span>
                </div>
            </div>

            <div class="control-group">
                <div class="control-header">
                    <span>4. å‡æ¸©é€Ÿç‡ (Heating Rate)</span>
                    <span id="val-rate" class="control-val">50â„ƒ/min</span>
                </div>
                <input type="range" min="5" max="300" step="5" value="50" oninput="updateParam('rate', this.value)">
                <div class="control-desc"><span>æ…¢é€Ÿ(åç¨³æ€)</span><span>å¿«é€Ÿ(ååŠ¨åŠ›å­¦)</span></div>
            </div>

            <div class="control-group">
                <div class="control-header">
                    <span>5. å›ºä½“åœç•™æ—¶é—´ (Residence Time)</span>
                    <span id="val-time" class="control-val">45 min</span>
                </div>
                <input type="range" min="15" max="120" step="5" value="45" oninput="updateParam('time', this.value)">
                <div class="control-desc">
                    <span>çŸ­æ—¶(å‡å°‘äºŒæ¬¡ååº”)</span>
                    <span>é•¿æ—¶(ååº”å½»åº•/è£‚è§£)</span>
                </div>
            </div>
        </div>
        
        <!-- D. åå¤„ç† (Post-processing) -->
        <div class="panel-section" style="border-bottom: none;">
            <div class="section-title"><i>â„ï¸</i> åå¤„ç†ç³»ç»Ÿ (Downstream)</div>
             <div class="control-group">
                <div class="control-header">
                    <span>6. å†·å´æ°´æµé‡ (Coolant Flow)</span>
                    <span id="val-cool" class="control-val">100%</span>
                </div>
                <input type="range" min="20" max="150" value="100" oninput="updateParam('cool', this.value)">
                <div class="control-desc" id="cool-desc">
                    <span style="opacity: 0.7">å½±å“æ²¹æ”¶ç‡åŠå‡ºæ–™æ¸©åº¦</span>
                    <span>å‡ºç‚­: <b id="out-temp-val" style="color:var(--success)">45â„ƒ</b></span>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // å…¨å±€çŠ¶æ€ä¸å‚æ•°
    let isRunning = false;
    let animFrameId;
    
    // å·¥è‰ºå‚æ•° (é»˜è®¤å€¼)
    let params = {
        water: 15,  // å«æ°´ç‡ %
        size: 20,   // ç²’å¾„ mm
        temp: 550,  // æ¸©åº¦ â„ƒ
        rate: 50,   // å‡æ¸©é€Ÿç‡ â„ƒ/min
        time: 45,   // åœç•™æ—¶é—´ min
        cool: 100   // å†·å´æµé‡ %
    };

    // ä»¿çœŸç»“æœ (å®æ—¶è®¡ç®—)
    let results = {
        charYield: 0, oilYield: 0, gasYield: 0,
        outTemp: 25,
        charRate: 0, oilRate: 0, gasRate: 0 // ç›¸å¯¹é€Ÿç‡ç”¨äºåŠ¨ç”»
    };

    // å¯è§†åŒ–çŠ¶æ€å˜é‡
    let charPileLevel = 0; // ç‚­å †é«˜åº¦ (0-140)
    let oilTankLevel = 10; // æ²¹ç®±åŸºç¡€æ¶²ä½

    // ================== æ ¸å¿ƒäº¤äº’é€»è¾‘ ==================

    // 1. å¯åŠ¨/åœæ­¢ä»¿çœŸ
    function toggleSim() {
        isRunning = !isRunning;
        const btn = document.getElementById('btn-start');
        const status = document.getElementById('sys-status');
        const fire = document.getElementById('fire-effect');
        const indicators = document.querySelectorAll('.rate-indicator');
        
        const oilDripAnim = document.getElementById('oil-drip-anim');
        const oilDripOpAnim = document.getElementById('oil-drip-op-anim');

        if (isRunning) {
            btn.innerHTML = "âš ï¸ ç´§æ€¥åœæ­¢ (EMERGENCY STOP)";
            btn.classList.add('stop');
            status.innerHTML = "SYSTEM RUNNING";
            status.classList.add('running');
            
            fire.style.opacity = 1;
            indicators.forEach(el => el.classList.add('active'));
            
            if(oilDripAnim && oilDripAnim.beginElement) oilDripAnim.beginElement();
            if(oilDripOpAnim && oilDripOpAnim.beginElement) oilDripOpAnim.beginElement();

            calculateLogic();
            animFrameId = requestAnimationFrame(simulationLoop);

        } else {
            btn.innerHTML = "å¯åŠ¨å·¥è‰ºæµç¨‹ (START)";
            btn.classList.remove('stop');
            status.innerHTML = "SYSTEM STANDBY";
            status.classList.remove('running');
            
            fire.style.opacity = 0;
            indicators.forEach(el => el.classList.remove('active'));
            resetFlows();

            cancelAnimationFrame(animFrameId);
        }
    }

    // 2. X-Ray é€è§†æ§åˆ¶
    function updateXRay(val) {
        const opacity = val / 100;
        const inverse = 1 - opacity;
        document.querySelectorAll('.shell').forEach(el => el.style.opacity = opacity);
        document.querySelectorAll('.inner-mech, .inner-material').forEach(el => {
            el.style.opacity = (inverse > 0.1) ? inverse : 0;
        });
    }

    // 3. å‚æ•°æ›´æ–°ç»Ÿä¸€å…¥å£
    function updateParam(key, val) {
        params[key] = parseInt(val);
        const unitMap = { water:'%', size:'mm', temp:'â„ƒ', rate:'â„ƒ/min', time:'min', cool:'%' };
        document.getElementById(`val-${key}`).innerText = val + unitMap[key];
        
        if(isRunning) calculateLogic();
        if(key === 'cool' || key === 'temp') updateTempPreview();
    }


    // ================== ã€æ ¸å¿ƒå‡çº§ã€‘ç§‘å­¦å·¥è‰ºä»¿çœŸç®—æ³• (V8) ==================
    // åŸºäºç”Ÿç‰©è´¨çƒ­è§£åŠ¨åŠ›å­¦ä¸å·¥ç¨‹ç»éªŒçš„åŠç»éªŒæ¨¡å‹
    function calculateLogic() {
        // --- A. åŸºç¡€å¹²åŸºç‰©æ–™å¹³è¡¡ (Base Dry Mass Balance) ---
        // å‡è®¾å…¸å‹æœ¨è´¨çº¤ç»´ç´ åŸæ–™: æŒ¥å‘åˆ†V=75%, å›ºå®šç¢³FC=20%, ç°åˆ†A=5%
        const baseFC = 20; const baseAsh = 5; const baseVol = 75;

        // 1. è®¡ç®—å¹²åŸºç”Ÿç‰©ç‚­äº§ç‡ (Dry Char Yield)
        // å½±å“å› ç´ : æ¸©åº¦(ä¸», è´Ÿç›¸å…³), å‡æ¸©é€Ÿç‡(æ¬¡, è´Ÿç›¸å…³), ç²’å¾„(æ¬¡, æ­£ç›¸å…³)
        
        // æ¸©åº¦å› å­: ä½¿ç”¨æŒ‡æ•°è¡°å‡æ¨¡æ‹Ÿç‚­åŒ–ç¨‹åº¦ã€‚ä½æ¸©(300C)ç‚­äº§ç‡é«˜ï¼Œé«˜æ¸©(800C)è¶‹è¿‘äºå›ºå®šç¢³+ç°åˆ†
        // T_eff æ˜¯æœ‰æ•ˆæ¸©åº¦ï¼Œå—ç²’å¾„å½±å“ã€‚å¤§ç²’å¾„ä¼ çƒ­æ…¢ï¼Œæœ‰æ•ˆæ¸©åº¦ä½
        let sizeEffect = (params.size - 20) * 1.5; // ç²’å¾„ä¿®æ­£
        let T_eff = params.temp - sizeEffect; 
        
        // åŸºç¡€ç‚­åŒ–æ¨¡å‹: Char = (FC+A) + (Volatiles * exp(-k * T))
        // k å€¼å—å‡æ¸©é€Ÿç‡å½±å“ã€‚æ…¢é€Ÿ(rateä½) kå°ï¼Œç‚­å¤šï¼›å¿«é€Ÿ(rateé«˜) kå¤§ï¼Œç‚­å°‘ã€‚
        let k_rate = 0.003 * (params.rate / 50); // é€Ÿç‡å› å­
        let volatileResidual = baseVol * Math.exp(-k_rate * (T_eff - 250)); // 250åº¦èµ·å§‹ç‚­åŒ–
        volatileResidual = Math.max(0, Math.min(baseVol, volatileResidual)); // é™åˆ¶èŒƒå›´

        let dryChar = baseFC + baseAsh + volatileResidual;
        // ä½æ¸©ä¿æŠ¤: 300åº¦ä»¥ä¸‹ååº”å¾ˆæ…¢ï¼Œç‚­äº§ç‡åº”å¾ˆé«˜
        if(params.temp < 350) dryChar = Math.max(dryChar, 45 - (params.temp-300)*0.2);


        // 2. è®¡ç®—å¹²åŸºæ€»æŒ¥å‘åˆ† (Dry Total Volatiles)
        let dryVolatilesTotal = 100 - dryChar;

        // 3. æŒ¥å‘åˆ†äº§ç‰©åˆ†å¸ƒ (æ²¹/æ°”æ¯”) (Oil/Gas Partitioning)
        // æ ¸å¿ƒæœºåˆ¶: ç«äº‰ååº”ä¸äºŒæ¬¡è£‚è§£
        // å½±å“å› ç´ : æ¸©åº¦(éçº¿æ€§), å‡æ¸©é€Ÿç‡(æ­£ç›¸å…³äº§æ²¹), åœç•™æ—¶é—´(é«˜æ¸©ä¸‹è´Ÿç›¸å…³äº§æ²¹)

        // åŸºç¡€æ²¹ç›¸æ¯”ä¾‹: å‘ˆé’Ÿå½¢æ›²çº¿ï¼Œå³°å€¼åœ¨ 500-550åº¦
        let peakTemp = 525;
        let sigma = 100; // åˆ†å¸ƒå®½åº¦
        // é«˜æ–¯å‡½æ•°æ¨¡æ‹ŸåŸºç¡€äº§æ²¹åˆ†å¸ƒ
        let baseOilRatio = 0.75 * Math.exp(-Math.pow(params.temp - peakTemp, 2) / (2 * Math.pow(sigma, 2)));

        // å‡æ¸©é€Ÿç‡ä¿®æ­£: å¿«é€Ÿçƒ­è§£æ˜¾è‘—æé«˜æ²¹æ”¶ç‡
        let rateBonus = (params.rate - 50) * 0.0015;
        // åœç•™æ—¶é—´ä¿®æ­£: é«˜æ¸©é•¿æ—¶å¯¼è‡´äºŒæ¬¡è£‚è§£ (Secondary Cracking)
        let crackingPenalty = 0;
        if (params.temp > 550) {
            crackingPenalty = (params.temp - 550) * (params.time / 60) * 0.0008;
        }
        
        let finalOilRatio = baseOilRatio + rateBonus - crackingPenalty;
        finalOilRatio = Math.max(0.15, Math.min(0.85, finalOilRatio)); // é™åˆ¶åˆç†çš„å·¥ç¨‹èŒƒå›´

        let dryOil = dryVolatilesTotal * finalOilRatio;
        let dryGas = dryVolatilesTotal * (1 - finalOilRatio);

        // --- B. æ¹¿åŸºè®¡ç®—ä¸æ°´åˆ†å¹³è¡¡ (Wet Basis & Water Balance) ---
        // è¾“å…¥æ°´åˆ†: params.water (ç›¸å¯¹äºæ€»æ¹¿é‡)
        let waterIn = (params.water / (100 - params.water)) * 100; // è½¬æ¢ä¸ºç›¸å¯¹äºå¹²åŸºçš„æ°´åˆ†é‡
        
        // å†·å‡æ•ˆç‡: å—å†·å´æ°´æµé‡å½±å“
        let condEff = Math.min(1, Math.pow(params.cool / 80, 0.8)); // éçº¿æ€§æ•ˆç‡æ›²çº¿
        
        // æ°´åˆ†åˆ†é…: å¤§éƒ¨åˆ†å¯å†·å‡è¿›å…¥æ²¹ç›¸ï¼Œå°‘éƒ¨åˆ†ä»¥æ°´è’¸æ°”å½¢å¼è¿›å…¥æ°”ç›¸
        let waterToOil = waterIn * 0.95 * condEff; 
        let waterToGas = waterIn - waterToOil;
        
        // æœ‰æœºæ²¹å†·å‡æŸå¤±: å†·å´ä¸è¶³å¯¼è‡´éƒ¨åˆ†è½»è´¨æ²¹ç»„åˆ†é€ƒé€¸è¿›å…¥æ°”ç›¸
        let oilLossToGas = dryOil * (1 - condEff) * 0.5; // å‡è®¾50%æœªå†·å‡æ²¹å˜ä¸ºæ°”
        dryOil = dryOil - oilLossToGas;
        dryGas = dryGas + oilLossToGas;

        // --- C. æ±‡æ€»æœ€ç»ˆç»“æœ ---
        let totalMassWet = dryChar + dryOil + waterToOil + dryGas + waterToGas;

        results.charYield = (dryChar / totalMassWet) * 100;
        results.oilYield = ((dryOil + waterToOil) / totalMassWet) * 100; // ç”Ÿç‰©æ²¹å«æ°´
        results.gasYield = ((dryGas + waterToGas) / totalMassWet) * 100;

        // --- D. è¿‡ç¨‹å‚æ•°è®¡ç®— ---
        // å‡ºç‚­æ¸©åº¦ = çƒ­è§£æ¸©åº¦ - å†·å´èƒ½åŠ› (ç®€åŒ–æ¨¡å‹)
        results.outTemp = params.temp - (params.cool * 3.5);
        results.outTemp = Math.max(30, results.outTemp);

        // è®¡ç®—ç›¸å¯¹é€Ÿç‡ (ç”¨äºåŠ¨ç”»é©±åŠ¨ï¼Œå½’ä¸€åŒ–åˆ° 0-1 èŒƒå›´)
        results.charRate = Math.min(1, results.charYield / 50);
        results.oilRate = Math.min(1, results.oilYield / 60);
        results.gasRate = Math.min(1, results.gasYield / 40);

        updateView();
    }


    // ================== è§†å›¾æ›´æ–°ä¸å¯è§†åŒ–é©±åŠ¨ (V8 ç¾åŒ–ç‰ˆ) ==================
    function updateView() {
        // 1. æ›´æ–°ä»ªè¡¨ç›˜æ•°å­—
        document.getElementById('db-char').innerText = results.charYield.toFixed(1) + '%';
        document.getElementById('db-oil').innerText = results.oilYield.toFixed(1) + '%';
        document.getElementById('db-gas').innerText = results.gasYield.toFixed(1) + '%';
        updateTempPreview();

        // 2. é©±åŠ¨å¯è§†åŒ–åŠ¨ç”»
        
        // A. æœºæ¢°è½¬é€Ÿæ§åˆ¶
        let speedFactor = 45 / params.time;
        setRotationSpeed('anim-crush-1', 0.6 / speedFactor);
        setRotationSpeed('anim-crush-2', 0.6 / speedFactor);
        setRotationSpeed('anim-feed-screw', 2.5 / speedFactor);
        setRotationSpeed('anim-kiln-screw', 6.0 / speedFactor);
        setRotationSpeed('anim-cool-screw', 3.5 / speedFactor);

        // B. æµä½“æµé‡æ§åˆ¶ ã€æ ¸å¿ƒç¾åŒ–ç‚¹ï¼šæ›´ç»†ã€æ›´ç²¾è‡´çš„çº¿æ¡ã€‘
        // åŸæ–™æµ
        setFlow('flow-feed', 4, 3); // å®½åº¦4px
        setFlow('flow-dry', 4, 3);

        // çƒ­è§£æ°”æµ (å®½åº¦ 3px - 10px)
        let gasWidth = 3 + results.gasRate * 7;
        let gasSpeed = 3.5 - results.gasRate * 2.5;
        setFlow('flow-raw-gas', gasWidth, gasSpeed);
        setFlow('flow-clean-gas', gasWidth*0.8, gasSpeed);
        let rotameterY = -20 + results.gasRate * 35;
        document.getElementById('gas-rotameter').setAttribute('transform', `translate(0, ${rotameterY})`);

        // ç”Ÿç‰©æ²¹æµ
        let oilWaveHeight = 10 + results.oilRate * 12;
        document.getElementById('oil-wave-anim').setAttribute('values', `${oilWaveHeight};${oilWaveHeight+2};${oilWaveHeight}`);
        const oilDripAnim = document.getElementById('oil-drip-anim');
        if(oilDripAnim) oilDripAnim.setAttribute('dur', `${1.8 - results.oilRate*1.2}s`);

        // ç”Ÿç‰©ç‚­æµ (å®½åº¦ 5px - 12px)
        let charWidth = 5 + results.charRate * 7;
        setFlow('flow-hot-char', charWidth, 3.5);
        setFlow('flow-cooled-char', charWidth, 3.5);
        
        // é«˜æ¸©è­¦æŠ¥è§†è§‰
        const hotCharFlow = document.getElementById('flow-hot-char');
        const outTempVal = document.getElementById('out-temp-val');
        if(results.outTemp > 100) {
            hotCharFlow.style.stroke = 'var(--danger)';
            // åˆ‡æ¢æ»¤é•œä»¥å¢å¼ºé«˜æ¸©æ„Ÿ (å¯é€‰)
            outTempVal.style.color = 'var(--danger)';
        } else if (results.outTemp > 60) {
            hotCharFlow.style.stroke = 'var(--char-hot)';
            outTempVal.style.color = 'var(--warning)';
        } else {
            hotCharFlow.style.stroke = '#666';
            outTempVal.style.color = 'var(--success)';
        }

        // C. ååº”ç‚‰å†…éƒ¨çŠ¶æ€
        const kilnMat = document.getElementById('kiln-material');
        if (params.temp > 600) {
            kilnMat.children[2].setAttribute('fill', '#d32f2f');
        } else {
            kilnMat.children[2].setAttribute('fill', '#222');
        }
    }

    // è¾…åŠ©å‡½æ•°
    function setRotationSpeed(id, dur) {
        const el = document.getElementById(id);
        if(el) el.style.animationDuration = dur + 's';
    }
    function setFlow(id, width, dur) {
        const el = document.getElementById(id);
        if(el) {
            // V8ä¿®æ”¹ï¼šä¸å†ä½¿ç”¨ scaleï¼Œç›´æ¥è®¾ç½®ç²¾ç¡®çš„åƒç´ å®½åº¦
            el.style.strokeWidth = width + 'px'; 
            el.style.animationDuration = dur + 's';
            el.classList.add('flowing');
        }
    }
    function resetFlows() {
        document.querySelectorAll('.flow-stream').forEach(el => {
            el.style.strokeWidth = 0;
            el.classList.remove('flowing');
        });
        document.getElementById('gas-rotameter').setAttribute('transform', `translate(0, -20)`);
    }
    function updateTempPreview() {
        let temp = params.temp - (params.cool * 3.5);
        temp = Math.max(30, temp);
        document.getElementById('out-temp-val').innerText = temp.toFixed(0) + 'â„ƒ';
    }

    // ================== å¾ªç¯ç´¯ç§¯åŠ¨ç”» ==================
    function simulationLoop() {
        if(!isRunning) return;

        // 1. ç‚­å †ç´¯ç§¯
        let growth = results.charRate * 0.25; 
        charPileLevel += growth;
        if (charPileLevel > 140) charPileLevel = 140;
        const pile = document.getElementById('char-pile-visual');
        pile.setAttribute('y', 140 - charPileLevel);
        pile.setAttribute('height', charPileLevel);

        // 2. æ²¹ç®±æ¶²ä½ç´¯ç§¯
        if (oilTankLevel < 55) {
            oilTankLevel += results.oilRate * 0.04;
            const oilViz = document.getElementById('oil-level-visual');
            const oilAnimY = document.getElementById('oil-wave-anim-y');
            oilViz.setAttribute('height', oilTankLevel);
            oilViz.setAttribute('y', 50 - oilTankLevel);
            let baseY = 50 - oilTankLevel;
            oilAnimY.setAttribute('values', `${baseY};${baseY-2};${baseY}`);
        }

        animFrameId = requestAnimationFrame(simulationLoop);
    }

    // åˆå§‹åŒ–
    updateXRay(100);
    updateTempPreview();

</script>
</body>
</html>